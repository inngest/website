# Insights

Inngest Insights allows you to query and analyze your event data using SQL directly within the Inngest platform. Every event sent to Inngest contains valuable information, and Insights gives you the power to extract meaningful patterns and analytics from that data.

## Overview

Insights provides an in-app SQL editor and query interface where you can:
- Query event data using familiar SQL syntax
- Save and reuse common queries
- Analyze patterns in your event streams
- Extract business intelligence from your workflows

Currently, you can **only query events**. Support for querying function runs will be added in future releases.

## Getting Started

Access Insights through the Inngest dashboard by clicking on the "Insights" tab in the left navigation. 

![Getting Started Dashboard View](/assets/docs/platform/monitor/insights/insights_dashboard_view.png)

We have several pre-built query templates to help you get started exploring your data.

![Getting Started Templates View](/assets/docs/platform/monitor/insights/insights_template_view.png)

## SQL Editor

The Insights interface includes a full-featured SQL editor where you can:

- Write and execute SQL queries against your event data
- Save frequently used queries for later access
- View query results in an organized table format
- Access query history and templates from the sidebar

![Sql Editor View](/assets/docs/platform/monitor/insights/insights_sql_editor.png)

### Available Columns

When querying events, you have access to the following columns:

| Column | Type | Description |
|--------|------|-------------|
| `event_id` | String | Unique identifier for the event |
| `event_name` | String | The name/type of the event |
| **`event_data`** | **JSON** | **The event payload data - users can send any JSON structure here** |
| `event_ts` | DateTime | Timestamp when the event occurred |
| `event_v` | String | Event format version |

For more details on the event format, see the [Inngest Event Format documentation](https://www.inngest.com/docs/features/events-triggers/event-format).

### Data Retention

You can query events from **up to 30 days in the past**. Older events are not available through Insights.

### Result Limits

- Current page limit: **1000 rows**
- Future updates will support larger result sets through async data exports
- Pagination support is planned for future releases

## SQL Support

Insights is built on ClickHouse, which provides powerful SQL capabilities with some differences from traditional SQL databases.

![Sql Editor View](/assets/docs/platform/monitor/insights/insights_query_results.png)

### Supported Functions

#### Arithmetic Functions
Basic mathematical operations and calculations.
[View ClickHouse arithmetic functions documentation](https://clickhouse.com/docs/sql-reference/functions/arithmetic-functions)

#### String Functions
String manipulation and search capabilities.
- [String search functions](https://clickhouse.com/docs/sql-reference/functions/string-search-functions)
- [String manipulation functions](https://clickhouse.com/docs/sql-reference/functions/string-functions)

#### JSON Functions
Essential for working with `event_data` payloads.
[View ClickHouse JSON functions documentation](https://clickhouse.com/docs/sql-reference/functions/json-functions)

#### Date/Time Functions
For analyzing event timing and patterns.
[View ClickHouse date/time functions documentation](https://clickhouse.com/docs/sql-reference/functions/date-time-functions)

#### Other Supported Function Categories
- [Logical functions](https://clickhouse.com/docs/sql-reference/functions/logical-functions)
- [Rounding functions](https://clickhouse.com/docs/sql-reference/functions/rounding-functions)
- [Type conversion functions](https://clickhouse.com/docs/sql-reference/functions/type-conversion-functions)
- [Functions for nulls](https://clickhouse.com/docs/sql-reference/functions/functions-for-nulls)
- [ULID functions](https://clickhouse.com/docs/sql-reference/functions/ulid-functions)

### Aggregate Functions

The following aggregate functions are supported:

| Function | Description |
|----------|-------------|
| `ARRAY_AGG()` | Aggregates values into an array* |
| `AVG()` | Calculates average |
| `COUNT()` | Counts rows |
| `MAX()` | Finds maximum value |
| `MIN()` | Finds minimum value |
| `STDDEV_POP()` | Population standard deviation |
| `STDDEV_SAMP()` | Sample standard deviation |
| `SUM()` | Calculates sum |
| `VAR_POP()` | Population variance |
| `VAR_SAMP()` | Sample variance |
| `median()` | Finds median value |

> **\*Note on ARRAY_AGG**: Due to a current serialization bug, you need to convert arrays to strings using `toString(ARRAY_AGG(column_name))`.

[View complete ClickHouse aggregate functions documentation](https://clickhouse.com/docs/sql-reference/aggregate-functions/reference)

### SQL Syntax Limitations

Some SQL features are not yet supported but are planned for future releases:

- **CTEs (Common Table Expressions)** using `WITH`
- **`IS` operator**
- **`NOT` operator**


## Working with Event Data

### Common Schema vs Event-Specific Schema

**Common Schema**: These columns are available for every user and every event:
- `event_id`
- `event_name` 
- `event_ts`
- `event_v`
- `event_data`

**Event-Specific Schema**: Within **`event_data`**, users can send any JSON they want, so the structure and available fields will be specific to their payloads. You can use ClickHouse's JSON functions to extract and query specific fields within your event data.

### Example Queries

#### Basic Event Filtering
```sql
SELECT count(*)
FROM events
WHERE event_name = 'inngest/function.failed'
AND simpleJSONExtractString(event_data, 'function_id') = 'generate-report'
AND event_ts > toUnixTimestamp(addHours(now(), -1)) * 1000;
```

#### Extracting JSON Data and Aggregating
```sql
SELECT simpleJSONExtractString(event_data, 'user_id') as user_id, count(*) 
FROM events
WHERE event_name = 'order.created'
GROUP BY user_id
ORDER BY count(*) DESC
LIMIT 10;
```

## Saved Queries

You can save frequently used queries for quick access. Currently, saved queries are stored in your browser's local storage.

> **Note**: Saved queries are only available on the device and browser where you created them. Cloud synchronization of saved queries is planned for a future release.

## Common Errors and Troubleshooting

### Array Serialization Issues
When using `ARRAY_AGG()`, you must convert the result to a string:

**Correct:**
```sql
SELECT toString(ARRAY_AGG(event_id)) as event_ids FROM events
```

**Incorrect:**
```sql
SELECT ARRAY_AGG(event_id) as event_ids FROM events  -- This will cause serialization errors
```

## Roadmap

### Coming Soon
- Query support for function runs
- `received_at` column for tracking event receipt time
- Pagination for large result sets
- Async data exports for results larger than 1000 rows

### Future Enhancements
- Support for CTEs (Common Table Expressions)
- `IS` and `NOT` operators
- Cloud synchronization for saved queries
- Advanced visualization capabilities

## Need Help?

If you encounter issues or have questions about Insights:
1. Check this documentation for common solutions
2. Review the [ClickHouse SQL reference](https://clickhouse.com/docs/sql-reference/) for advanced function usage
3. Contact support through the Inngest platform

---

*Insights is actively under development. Features and column names may change as we continue to improve the product.*